<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ title }}</title>
  <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
  <div class="snowflake">â…</div><div class="snowflake">â†</div><div class="snowflake">â…</div><div class="snowflake">â†</div><div class="snowflake">â…</div><div class="snowflake">â†</div><div class="snowflake">â…</div><div class="snowflake">â†</div>

  <div class="wrap">
    <h1>ğŸ… 2025 Baking Comp ğŸª</h1>
    
    <section class="card">
      <h2>Rate a Treat</h2>
      <form id="rateForm">
        <label>Baker & Dessert</label>
        <select id="entrant" required>
          <option value="" disabled selected>Select...</option>
          {% for name in entrants %}
          <option value="{{ loop.index0 }}">{{ name }}</option>
          {% endfor %}
        </select>

        <div class="slider-group">
          <div id="santa-container"><div id="santa">ğŸ…</div></div>
          <label>Taste ğŸ˜‹ (Slide for Santa)</label>
          <input type="range" min="1" max="10" value="5" id="taste" oninput="updateSanta()">
          <div style="text-align:right; font-weight:bold" id="tasteVal">5</div>
        </div>

        <div class="slider-group">
          <label>Presentation ğŸ“¸</label>
          <input type="range" min="1" max="10" value="5" id="pres" oninput="updateVal('pres')">
          <div style="text-align:right; font-weight:bold" id="presVal">5</div>
        </div>

        <div class="slider-group">
          <div id="snowman-container"><div id="snowman">â˜ƒï¸</div></div>
          <label>Xmas Spirit ğŸ„ (Build Snowman)</label>
          <input type="range" min="1" max="10" value="5" id="spirit" oninput="updateSnowman()">
          <div style="text-align:right; font-weight:bold" id="spiritVal">5</div>
        </div>

        <input type="text" id="one_word" placeholder="One Word Description">
        <input type="text" id="judge" placeholder="Your Name (Optional)">
        <button type="submit" class="btn">Submit Vote ğŸ</button>
      </form>
    </section>

    <section class="card">
      <h2>ğŸ† Leaderboard (Avg Score)</h2>
      <table class="table" id="lbTable">
        <thead><tr><th>Rank</th><th>Baker</th><th>Votes</th><th>Avg</th></tr></thead>
        <tbody></tbody>
      </table>
      <div style="text-align:center; margin-top:15px">
        <a href="/words">See Word Cloud</a> | <a href="/admin">Admin Login</a>
      </div>
    </section>
  </div>

<script>
function updateVal(id) { document.getElementById(id+'Val').innerText = document.getElementById(id).value; }

function updateSanta() {
  const val = document.getElementById('taste').value;
  document.getElementById('tasteVal').innerText = val;
  // Move Santa 0% to 90% across
  const pct = (val - 1) * 10; 
  document.getElementById('santa-container').style.left = pct + "%";
}

function updateSnowman() {
  const val = document.getElementById('spirit').value;
  document.getElementById('spiritVal').innerText = val;
  // Grow Snowman
  const size = 20 + (val * 4); // 24px to 60px
  document.getElementById('snowman').style.fontSize = size + "px";
}

document.getElementById('rateForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const payload = {
    entrant_index: document.getElementById('entrant').value,
    taste: document.getElementById('taste').value,
    presentation: document.getElementById('pres').value,
    spirit: document.getElementById('spirit').value,
    one_word: document.getElementById('one_word').value,
    judge: document.getElementById('judge').value
  };
  await fetch('/api/rate', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload)});
  alert("Vote Cast! ğŸ„");
  loadLB();
});

async function loadLB(){
  const res = await fetch('/api/leaderboard');
  const data = await res.json();
  const tbody = document.querySelector('#lbTable tbody');
  tbody.innerHTML = data.map((r, i) => `<tr><td>#${i+1}</td><td>${r.name}</td><td>${r.votes}</td><td><strong>${r.avg_total}</strong></td></tr>`).join('');
}
loadLB();
setInterval(loadLB, 5000);
</script>
</body>
</html>
